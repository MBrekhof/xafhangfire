# TODO — Job Dispatcher POC

## Current Status

**Session 1 (2026-02-18):** All 3 phases implemented. Solution builds clean (0 warnings, 0 errors). Pushed to GitHub. Needs manual smoke test (run the app, hit the API endpoints, check Hangfire dashboard).

## Phase 1: Core Plumbing — DONE
- [x] Create `xafhangfire.Jobs` class library project
- [x] Implement `IJobHandler<TCommand>` interface
- [x] Implement `IJobDispatcher` interface
- [x] Implement `DirectJobDispatcher`
- [x] Implement `HangfireJobDispatcher` + `JobExecutor<TCommand>`
- [x] Create `DemoLogCommand` + `DemoLogHandler`
- [x] Create `ListUsersCommand` + `ListUsersHandler`
- [x] Add Hangfire NuGet packages to Blazor.Server
- [x] Wire DI registration + config toggle in `Startup.cs`
- [x] Build and verify both dispatcher modes work

## Phase 2: Admin UI — DONE
- [x] Create `JobDefinition` business object in Module
- [x] Add `DbSet<JobDefinition>` to DbContext
- [x] Register in Module.cs
- [x] XAF ListView + DetailView for JobDefinition (auto-generated by XAF)
- [x] `JobTestController` API endpoint for manual triggering
- [x] `AddJobHandler` / `AddJobDispatcher` DI extension methods
- [ ] Wire JobDefinition → Hangfire recurring job sync on app startup
- [ ] Seed sample JobDefinition records in `Updater.cs`

## Phase 3: Scheduler — DONE (foundation)
- [x] DevExpress Scheduler module added and registered
- [x] `RunNow` action on JobDefinition (placeholder — shows message)
- [x] `DateRangeResolver` for friendly calendar terms
- [ ] Scheduler view actually bound to JobDefinition as calendar appointments
- [ ] Cron expression → next-run visualization
- [ ] Wire `RunNow` action to actually dispatch via `IJobDispatcher`

## Follow-Up Work
- [ ] Wire `RunNow` action to `IJobDispatcher` (requires Module → Jobs project reference)
- [ ] Sync `JobDefinition` entities to Hangfire recurring jobs on startup
- [ ] Seed sample JobDefinition records in `Updater.cs`
- [ ] Scheduler calendar view bound to JobDefinition
- [ ] Swap Hangfire.InMemory → SQL Server or SQLite for persistence
- [ ] Email jobs (MailKit)
- [ ] Report generation (DevExpress XtraReport)
- [ ] Mail merge (report + email composition)
- [ ] Rich parameter UI (dynamic forms from command metadata)

## Claude Continuation Instructions

When resuming this project, read these files first:
1. `CLAUDE.md` — project conventions and build commands
2. `TODO.md` — current progress (this file)
3. `docs/plans/2026-02-18-job-dispatcher-design.md` — approved design
4. `job-dispatcher-architecture.md` — original architecture reference
5. `xafhangfire/xafhangfire.Jobs/` — Jobs project (interfaces, dispatchers, handlers, DateRangeResolver)
6. `xafhangfire/xafhangfire.Module/BusinessObjects/JobDefinition.cs` — admin entity
7. `xafhangfire/xafhangfire.Module/Controllers/JobSchedulerViewController.cs` — RunNow action
8. `xafhangfire/xafhangfire.Blazor.Server/Startup.cs` — DI wiring

Then check the TODO list above to see what's done and what's next.

## Known Gotcha
- DevExpress 25.2 removed `SizeAttribute`. Use `FieldSizeAttribute` from `DevExpress.ExpressApp.DC` instead.
